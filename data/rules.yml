#rules.yml
version: "3.1"

rules:
  # Ask for details when user reports issue
  - rule: Ask for problem details
    steps:
      - intent: report_issue
      - action: utter_ask_for_details

  # When user provides problem description, capture it and ask for username
  - rule: Start form with problem
    steps:
      - intent: problem_description
      - slot_was_set:
        - reclamation_message
      - action: utter_ask_username

  # Handle direct problem description
  - rule: Handle direct problem description
    steps:
      - intent: problem_description
      - slot_was_set:
        - reclamation_message
      - action: utter_ask_username

  # Submit tracking form when completed
  - rule: Submit tracking form
    condition:
      - active_loop: track_reclamation_form
    steps:
      - action: track_reclamation_form
      - active_loop: null
      - action: action_track_reclamation

  # Goodbye rule
  - rule: Say goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  # Company info rules
  - rule: Respond to company info request
    steps:
      - intent: ask_company_info
      - action: utter_company_info

  - rule: Respond to company history
    steps:
      - intent: company_history
      - action: utter_company_history

  - rule: Respond to company services
    steps:
      - intent: company_services
      - action: utter_company_services

  - rule: Respond to company contact
    steps:
      - intent: company_contact
      - action: utter_contact

  - rule: Respond to company values
    steps:
      - intent: company_values
      - action: utter_company_values

  - rule: Respond to company mission
    steps:
      - intent: company_mission
      - action: utter_company_mission

  - rule: Respond to product support
    steps:
      - intent: product_support
      - action: utter_product_support

  - rule: Respond to system security
    steps:
      - intent: system_security_questions
      - action: utter_system_security_questions

  # TRACKING RULES
  - rule: Activate tracking form
    steps:
      - intent: track_reclamation
      - action: utter_ask_track_reclamation
      - action: track_reclamation_form
      - active_loop: track_reclamation_form

  # FIXED: Submit reclamation form
  - rule: Submit reclamation form
    condition:
      - active_loop: reclamation_form
    steps:
      - action: reclamation_form
      - active_loop: null
      - action: action_submit_reclamation
      - action: utter_goodbye  # ADDED: Make consistent with stories



